<div class="flex h-screen futuristic-messages-page">
  <!-- Sidebar -->
  <div
    class="w-full md:w-80 lg:w-96 border-r border-accent-transparent futuristic-sidebar flex flex-col"
  >
    <!-- Header futuriste -->
    <div
      class="p-4 border-b border-accent-transparent futuristic-header sticky top-0 z-10"
    >
      <div class="flex justify-between items-center mb-4">
        <h1 class="text-xl font-semibold futuristic-title">Messages</h1>
        <div class="flex items-center space-x-2">
          <button
            (click)="startNewConversation()"
            class="futuristic-action-button"
            title="Nouvelle conversation"
          >
            <i class="fas fa-edit"></i>
          </button>
          <span *ngIf="unreadCount$ | async as count" class="futuristic-badge">
            {{ count }}
          </span>
        </div>
      </div>

      <!-- Recherche futuriste -->
      <div class="relative">
        <input
          [(ngModel)]="searchQuery"
          (ngModelChange)="filterConversations()"
          type="text"
          placeholder="Rechercher des conversations..."
          class="w-full pl-10 pr-4 py-2 futuristic-input-field"
        />
        <i class="fas fa-search absolute left-3 top-3 text-accent"></i>
      </div>
    </div>

    <!-- Liste des conversations futuriste -->
    <div class="flex-1 overflow-y-auto futuristic-conversations-list">
      <!-- État de chargement futuriste -->
      <div
        *ngIf="loading"
        class="flex flex-col items-center justify-center h-full p-4"
      >
        <div class="futuristic-loading-circle"></div>
        <p class="mt-3 futuristic-loading-text">
          Chargement des conversations...
        </p>
      </div>

      <!-- État d'erreur futuriste -->
      <div *ngIf="error" class="futuristic-error-container">
        <div class="futuristic-error-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="futuristic-error-content">
          <h3 class="futuristic-error-title">
            Erreur de chargement des conversations
          </h3>
          <p class="futuristic-error-message">{{ error }}</p>
          <button (click)="loadConversations()" class="futuristic-retry-button">
            <i class="fas fa-sync-alt mr-1"></i> Réessayer
          </button>
        </div>
      </div>

      <!-- État vide futuriste -->
      <div
        *ngIf="!loading && filteredConversations.length === 0 && !searchQuery"
        class="flex flex-col items-center justify-center h-full p-6 text-center futuristic-empty-state"
      >
        <div class="futuristic-empty-icon">
          <i class="fas fa-comments"></i>
        </div>
        <h3 class="futuristic-empty-title">Aucune conversation</h3>
        <p class="futuristic-empty-text">
          Démarrez une nouvelle conversation pour communiquer
        </p>
        <button
          (click)="startNewConversation()"
          class="futuristic-start-button"
        >
          <i class="fas fa-plus-circle mr-2"></i>
          Nouvelle Conversation
        </button>
      </div>

      <!-- État sans résultats futuriste -->
      <div
        *ngIf="!loading && filteredConversations.length === 0 && searchQuery"
        class="flex flex-col items-center justify-center h-full p-6 text-center futuristic-no-results"
      >
        <div class="futuristic-empty-icon">
          <i class="fas fa-search"></i>
        </div>
        <h3 class="futuristic-empty-title">Aucun résultat trouvé</h3>
        <p class="futuristic-empty-text">Essayez un autre terme de recherche</p>
      </div>

      <!-- Conversations futuristes -->
      <ul
        *ngIf="!loading && filteredConversations.length > 0"
        class="futuristic-conversations"
      >
        <li
          *ngFor="let conv of filteredConversations"
          (click)="openConversation(conv.id)"
          [class.futuristic-conversation-selected]="
            selectedConversationId === conv.id
          "
          class="futuristic-conversation-item"
        >
          <!-- Avatar avec indicateur de statut -->
          <div class="futuristic-avatar">
            <img
              [src]="
                (conv.participants
                  ? getOtherParticipant(conv.participants)?.image
                  : null) || 'assets/images/default-avatar.png'
              "
              alt="User avatar"
            />
            <span
              *ngIf="
                conv.participants &&
                getOtherParticipant(conv.participants)?.isOnline
              "
              class="futuristic-online-indicator"
            ></span>
          </div>

          <!-- Détails de la conversation -->
          <div class="futuristic-conversation-details">
            <div class="futuristic-conversation-header">
              <h3 class="futuristic-conversation-name">
                {{
                  (conv.participants
                    ? getOtherParticipant(conv.participants)?.username
                    : null) || "Utilisateur inconnu"
                }}
              </h3>
              <span class="futuristic-conversation-time">
                {{ (conv.lastMessage?.timestamp | date : "shortTime") || "" }}
              </span>
            </div>

            <div class="futuristic-conversation-preview">
              <p class="futuristic-conversation-message">
                <span
                  *ngIf="conv.lastMessage?.sender?.id === currentUserId"
                  class="futuristic-you-prefix"
                  >Vous:
                </span>
                {{ conv.lastMessage?.content || "Pas encore de messages" }}
              </p>
              <span
                *ngIf="conv.unreadCount && conv.unreadCount > 0"
                class="futuristic-unread-badge"
              >
                {{ conv.unreadCount }}
              </span>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <!-- Zone de contenu principal futuriste -->
  <div class="flex-1 hidden md:flex flex-col futuristic-main-area">
    <!-- État par défaut vide -->
    <!-- <div *ngIf="!selectedConversationId" class="flex-1 flex items-center justify-center futuristic-empty-chat">
      <div class="text-center p-8">
        <div class="futuristic-empty-icon">
          <i class="fas fa-comment-dots"></i>
        </div>
        <h3 class="futuristic-empty-title">Sélectionnez une conversation</h3>
        <p class="futuristic-empty-text">Choisissez un chat existant ou démarrez-en un nouveau</p>
        <button (click)="startNewConversation()"
                class="futuristic-start-button">
          <i class="fas fa-plus-circle mr-2"></i>
          Nouvelle Conversation
        </button>
      </div>
    </div> -->

    <!-- Router outlet pour le composant de chat -->
    <router-outlet></router-outlet>
  </div>
</div>
