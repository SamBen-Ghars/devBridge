<div class="flex h-screen bg-gray-50">
  <!-- Sidebar -->
  <div
    class="w-full md:w-80 lg:w-96 border-r border-gray-200 bg-white flex flex-col"
  >
    <!-- Header -->
    <div class="p-4 border-b border-gray-200 bg-white sticky top-0 z-10">
      <div class="flex justify-between items-center mb-4">
        <h1 class="text-xl font-semibold text-gray-800">Messages</h1>
        <div class="flex items-center space-x-2">
          <button
            (click)="startNewConversation()"
            class="p-2 rounded-full hover:bg-gray-100 text-gray-600"
          >
            <i class="fas fa-edit"></i>
          </button>
          <span
            *ngIf="unreadCount$ | async as count"
            class="bg-purple-600 text-white text-xs font-medium rounded-full px-2 py-1 min-w-[1.5rem] text-center"
          >
            {{ count }}
          </span>
        </div>
      </div>

      <!-- Search -->
      <div class="relative">
        <input
          [(ngModel)]="searchQuery"
          (ngModelChange)="filterConversations()"
          type="text"
          placeholder="Search conversations..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
        />
        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
      </div>
    </div>

    <!-- Conversations List -->
    <div class="flex-1 overflow-y-auto">
      <!-- Loading State -->
      <div
        *ngIf="loading"
        class="flex flex-col items-center justify-center h-full p-4"
      >
        <div
          class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-purple-600"
        ></div>
        <p class="mt-3 text-gray-500">Loading conversations...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error" class="p-4 bg-red-50 border-l-4 border-red-500">
        <div class="flex items-start">
          <i class="fas fa-exclamation-circle text-red-500 mt-0.5 mr-2"></i>
          <div>
            <h3 class="text-sm font-medium text-red-800">
              Error loading conversations
            </h3>
            <p class="text-sm text-red-700 mt-1">{{ error }}</p>
            <button
              (click)="loadConversations()"
              class="mt-2 text-sm text-red-600 hover:text-red-800"
            >
              <i class="fas fa-sync-alt mr-1"></i> Try again
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div
        *ngIf="!loading && filteredConversations.length === 0 && !searchQuery"
        class="flex flex-col items-center justify-center h-full p-6 text-center"
      >
        <i class="fas fa-comments text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900">No conversations yet</h3>
        <p class="mt-1 text-gray-500">
          Start a new conversation to connect with your team
        </p>
        <button
          (click)="startNewConversation()"
          class="mt-4 px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 transition-colors"
        >
          New Conversation
        </button>
      </div>

      <!-- No Results State -->
      <div
        *ngIf="!loading && filteredConversations.length === 0 && searchQuery"
        class="flex flex-col items-center justify-center h-full p-6 text-center"
      >
        <i class="fas fa-search text-3xl text-gray-300 mb-3"></i>
        <h3 class="text-lg font-medium text-gray-900">No matches found</h3>
        <p class="mt-1 text-gray-500">Try a different search term</p>
      </div>

      <!-- Conversations -->
      <ul
        *ngIf="!loading && filteredConversations.length > 0"
        class="divide-y divide-gray-100"
      >
        <li
          *ngFor="let conv of filteredConversations"
          (click)="openConversation(conv.id)"
          [class.bg-purple-50]="selectedConversationId === conv.id"
          class="p-4 hover:bg-gray-50 cursor-pointer flex items-center transition-colors"
        >
          <!-- Avatar with status indicator -->

          <div class="relative flex-shrink-0 mr-3">
            <img
              [src]="
                (conv.participants
                  ? getOtherParticipant(conv.participants)?.image
                  : null) || 'assets/images/default-avatar.png'
              "
              class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm"
            />
            <span
              *ngIf="
                conv.participants &&
                getOtherParticipant(conv.participants)?.isOnline
              "
              class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"
            ></span>
          </div>

          <!-- Conversation details -->
          <div class="min-w-0 flex-1">
            <div class="flex justify-between items-baseline">
              <h3 class="text-sm font-medium text-gray-900 truncate">
                {{
                  (conv.participants
                    ? getOtherParticipant(conv.participants)?.username
                    : null) || "Unknown User"
                }}
              </h3>
              <span class="text-xs text-gray-500 whitespace-nowrap ml-2">
                {{ (conv.lastMessage?.timestamp | date : "shortTime") || "" }}
              </span>
            </div>

            <div class="flex justify-between items-center mt-1">
              <p class="text-sm text-gray-500 truncate">
                <span
                  *ngIf="conv.lastMessage?.sender?.id === currentUserId"
                  class="text-gray-400"
                  >You:
                </span>
                {{ conv.lastMessage?.content || "No messages yet" }}
              </p>
              <span
                *ngIf="conv.unreadCount && conv.unreadCount > 0"
                class="ml-2 bg-purple-600 text-white text-xs font-medium rounded-full w-5 h-5 flex items-center justify-center"
              >
                {{ conv.unreadCount }}
              </span>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="flex-1 hidden md:flex flex-col bg-gray-50">
    <!-- Default empty state -->
    <!-- <div *ngIf="!selectedConversationId" class="flex-1 flex items-center justify-center">
      <div class="text-center p-8">
        <i class="fas fa-comment-dots text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900">Select a conversation</h3>
        <p class="mt-1 text-gray-500">Choose an existing chat or start a new one</p>
        <button (click)="startNewConversation()"
                class="mt-4 px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 transition-colors">
          New Conversation
        </button>
      </div>
    </div> -->

    <!-- Router outlet for chat component -->
    <router-outlet></router-outlet>
  </div>
</div>
