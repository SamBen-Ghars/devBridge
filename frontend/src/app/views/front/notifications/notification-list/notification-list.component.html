<div class="futuristic-notifications-container">
  <div class="futuristic-notifications-card">
    <div class="futuristic-notifications-header">
      <h2 class="futuristic-title">Notifications</h2>
      <div class="flex space-x-2">
        <button
          (click)="loadNotifications()"
          class="futuristic-action-button"
          title="Rafraîchir"
        >
          <i class="fas fa-sync-alt"></i>
        </button>
        <button
          *ngIf="(unreadCount$ | async) || 0"
          (click)="markAllAsRead()"
          class="futuristic-primary-button"
        >
          <i class="fas fa-check-double mr-1"></i> Tout marquer comme lu
        </button>
      </div>
    </div>

    <!-- État de chargement futuriste -->
    <div *ngIf="loading" class="futuristic-loading-container">
      <div class="futuristic-loading-circle"></div>
      <p class="futuristic-loading-text">Chargement des notifications...</p>
    </div>

    <!-- État d'erreur futuriste -->
    <div *ngIf="error" class="futuristic-error-message">
      <div class="flex items-center">
        <i class="fas fa-exclamation-triangle futuristic-error-icon"></i>
        <div>
          <h3 class="futuristic-error-title">Erreur de chargement</h3>
          <p class="futuristic-error-text">{{ getErrorMessage() }}</p>
        </div>
        <button
          (click)="loadNotifications()"
          class="futuristic-retry-button ml-auto"
        >
          Réessayer
        </button>
      </div>
    </div>

    <!-- État vide futuriste -->
    <div
      *ngIf="!loading && !(hasNotifications() | async)"
      class="futuristic-empty-state"
    >
      <div class="futuristic-empty-icon">
        <i class="fas fa-bell-slash"></i>
      </div>
      <h3 class="futuristic-empty-title">Aucune notification</h3>
      <p class="futuristic-empty-text">Vous êtes à jour !</p>
      <button (click)="loadNotifications()" class="futuristic-check-button">
        Vérifier les nouvelles notifications
      </button>
    </div>

    <!-- Liste des notifications futuriste -->
    <div
      *ngIf="!loading && (hasNotifications() | async)"
      class="futuristic-notifications-list"
    >
      <ng-container *ngFor="let notification of notifications$ | async">
        <div
          [class.futuristic-notification-unread]="!notification.isRead"
          class="futuristic-notification-card"
        >
          <!-- Badge de notification futuriste -->
          <div
            *ngIf="!notification.isRead"
            class="futuristic-notification-badge"
          >
            <span class="futuristic-notification-indicator"></span>
          </div>

          <div class="flex items-start space-x-3">
            <!-- Avatar de l'expéditeur futuriste -->
            <div class="futuristic-avatar">
              <img
                *ngIf="notification.senderId?.image"
                [src]="notification.senderId?.image"
                alt="Avatar"
              />
              <div
                *ngIf="!notification.senderId?.image"
                class="futuristic-avatar-placeholder"
              >
                <i class="fas fa-user"></i>
              </div>
              <div
                *ngIf="notification.type === 'FRIEND_REQUEST'"
                class="futuristic-notification-type-icon"
              >
                <i class="fas fa-user-plus"></i>
              </div>
            </div>

            <!-- Contenu de notification futuriste -->
            <div class="futuristic-notification-content">
              <div class="flex items-baseline justify-between">
                <p class="futuristic-notification-text">
                  <span class="futuristic-notification-sender">{{
                    notification.senderId?.username || "Système"
                  }}</span>
                  {{ notification.content }}
                </p>
                <span class="futuristic-notification-time">
                  {{ notification.timestamp | date : "shortTime" }}
                </span>
              </div>

              <!-- Aperçu du message futuriste -->
              <div
                *ngIf="notification.message?.content"
                class="futuristic-message-preview"
              >
                {{ notification.message?.content }}
              </div>

              <!-- Boutons d'action futuristes -->
              <div class="futuristic-notification-actions">
                <button
                  *ngIf="!notification.isRead"
                  (click)="
                    markAsRead(notification.id); $event.stopPropagation()
                  "
                  class="futuristic-read-button"
                >
                  <i class="fas fa-check mr-1"></i> Marquer comme lu
                </button>

                <button
                  *ngIf="
                    notification.type === 'FRIEND_REQUEST' &&
                    !notification.isRead
                  "
                  (click)="
                    acceptFriendRequest(notification); $event.stopPropagation()
                  "
                  class="futuristic-accept-button"
                >
                  <i class="fas fa-user-plus mr-1"></i> Accepter
                </button>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
