<div
  class="voice-message-player messenger-style-voice-message"
  [ngClass]="{ 'is-playing': isPlaying }"
>
  <!-- Élément audio caché -->
  <audio
    #audioPlayer
    [src]="audioUrl"
    (ended)="onAudioEnded()"
    preload="metadata"
    style="display: none"
  ></audio>

  <!-- Bouton de lecture/pause style Messenger avec effet de pulsation -->
  <button
    class="play-button no-outline"
    (click)="togglePlay()"
    [ngClass]="{ 'pulse-animation': isPlaying }"
  >
    <i class="fas" [ngClass]="isPlaying ? 'fa-pause' : 'fa-play'"></i>
  </button>

  <div class="progress-container">
    <!-- Visualisation de l'onde sonore style Messenger -->
    <div class="waveform-container">
      <!-- Génération de 27 barres pour l'onde sonore (comme Messenger) -->
      <div class="waveform">
        <div
          *ngFor="
            let i of [
              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
              19, 20, 21, 22, 23, 24, 25, 26
            ]
          "
          class="waveform-bar"
          [ngClass]="{ active: isPlaying && progressPercentage > i * 3.7 }"
          [style.height.px]="getRandomBarHeight(i)"
        ></div>
      </div>

      <!-- Affichage du temps avec animation de fondu -->
      <div class="time-display" [ngClass]="{ 'fade-in': isPlaying }">
        <span class="duration">{{ formattedDuration }}</span>
      </div>
    </div>
  </div>
</div>
